# TCP 面试题

## TCP 三次握手及其原因



## TCP 四次挥手及其原因



## TCP 和 UDP 的区别和联系

用户数据报协议UDP 只在 IP 的数据报服务上增加了很少一点的功能, 这就是复用和端口分用的功能以及差错检测的功能.

1. TCP 面向连接, 传输数据之前需要建立连接, UDP 是无连接的.

   UDP在发送数据之前不需要建立连接, 因此减少了开销和发送数据之前的时延.

2. TCP 提供可靠传输, 保证数据不丢包 , 不重复且按序到达;  UDP 只尽最大努力交付, 不保证可靠交付**(UDP 继承了IP协议的基因)**; 

   通过TCP 连接传送的数据, 无差错, 不丢失, 不重复, 并且按序到达.

   UDP 只是尽最大的努力交付, 因此主机不需要维持复杂的连接状态.

3. TCP 提供了拥塞控制; UDP 不提供;

   由于UDP没有提供拥塞控制, 因此网络出现的拥塞不会使源主机的发送速率降低. 这对某些实时应用是很重要的. 很多实时应用(如 IP 电话, 例如微信/QQ视频和通话等) 要求源主机以恒定的速率发送数据, 并且允许在网络发生拥塞时丢失一些数据, 但却不允许数据有太大的时延. UDP 正好适合这种要求.

4. TCP 是面向字节流的; UDP 面向报文;

5. TCP 只支持点到点通信; UDP 支持一对一, 一对多, 多对多的通信;

6. TCP 首部开销大 (20 字节), UDP 首部开销小 (8字节).

## TCP 协议如何来保证传输的可靠性?

TCP 提供一种面向连接, 可靠的字节流服务. 其中, 面向连接意味着两个使用 TCP 的应用(通常是一个客户端和一个服务器) 在彼此交换数据之前必须先建立一个TCP 连接, 在一个 TCP 连接中, 仅有两方进行彼此通信;

对于可靠性, TCP 通过以下方式进行保证:

* **数据包校验:** 目的是检测数据在传输过程中的任何变化, 若校验出包有错,则丢弃报文段并且不给出响应, 此时TCP 发送端会超时重发该报文段.
* **对失序数据包重排序:** 既然TCP 报文段作为IP数据报来传输, 而IP 数据报的到达可能会失序. TCP 将对失序数据进行重新排序, 然后才交给应用层;
* **丢弃重复数据:** 对于重复数据,能够丢弃重复数据;
* **应答机制:**  当 TCP 收到发自TCP 连接另一端的数据,它将发送一个确认.
* **超时重发:** 当TCP 发出一个段后,它启动一个定时器,等待目的确认收到这个报文段. 如果不能及时收到一个确认, 将重发这个报文段.
* **流量控制:**  TCP 连接的每一方都有固定大小的缓冲空间. TCP 的接收端只允许另一端发送接收端缓冲区所能接纳的数据, 这可以防止较快主机致使较慢主机的缓冲区溢出, 这就是流量控制. TCP 使用的流量控制协议是可变大小的滑动窗口协议.

## 说一下滑动窗口协议

窗口是缓存的一部分, 用来暂时存放字节流. 发送方和接收方各有一个窗口, 接收方通过 **TCP 报文段中的窗口字段**告诉发送方自己的窗口大小, 发送方根据这个值和其它信息设置自己的窗口大小.

发送窗口内的字节都允许被发送,接收窗口内的字节都允许被接收. 如果发送窗口左部的字节已经发送并且收到了确认, 那么就将发送窗口向右滑动一段距离, 直到左部第一个字节不是已发送并且已确认的状态; 接收窗口的滑动类似, 接收窗口左部字节已经发送确认并交付主机, 就向右滑动接收窗口.

接收窗口只会对窗口内最后一个按序到达的字节进行确认, 例如接收窗口已经收到的字节为{31,34,35}, 其中{31}按序到达, 而{34, 35} 就不是, 因此只对字节 31 进行确认. 发送方得到一个字节的确认之后, 就知道这个字节之前的所有字节都已经被接收了.