# 秒杀项目面试要点

## 1. 如何解决超卖？

1. 给 redis 加锁，内存加锁

   setnx 方法可以实现锁机制，key 不存在时则创建并设置 value。返回值为1。 key 存在时返回值为 0。 setnx 返回值为 1 认为加锁成功，其他线程要等到当前业务操作完成释放锁后，才能再次调用 setnx 加锁成功。

2. redis 原子操作

   设置一个队列， key 为商品 id， 队列长度为商品库存量。每次请求到达时 pop 出一个元素，这样拿到元素的请求即认为秒杀成功，后续通过MQ发送消息异步完成数据库减库存。

3.  mysql 锁+redis 预减库存+ redis 缓存卖完标记

## 2. 如何解决重复下单？

mysql 唯一索引+分布式锁

## 3. 如何防刷？

IP限流 + 验证码

## 4. 热 key 问题如何解决？

redis 集群+本地缓存 + 限流 + key 加随机值分布在多个实例中

## 5. 消息队列的作用？

如何保证消息的不丢失？异步削峰；发送方开启confirm+消息队列持久化+消费方关闭自动ACK,确保消费成功之后自动调用API进行确认。

## 6. 缓存和数据库数据一致性如何保证？

秒杀项目不用保证，其他项目就用延时双删或者先更新数据再是缓存失效，为防缓存失效这一信息丢失，可用消息队***保。

## 7. 缓存雪崩什么情况下会发生？如何避免？

当多个商品缓存同时失效时会雪崩，导致大量查询数据库。还有就是秒杀刚开始的时候缓存里没有数据。解决方案：缓存预热，错开缓存失效时间