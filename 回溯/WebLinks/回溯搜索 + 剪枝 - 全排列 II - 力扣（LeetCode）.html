<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600986 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="5874"/>

<div>
<span>
  <div style="--en-clipped-content:article">
<div><br/></div><div style="font-size: 16px; display:block; min-width: 100%; position: relative;"> <div style="box-sizing:border-box;font-family:sans-serif;line-height:1.15;overflow:auto;"><div style="box-sizing:border-box;font-variant:tabular-nums;font-feature-settings:&quot;tnum&quot;;min-width:992px;background:rgb(255, 255, 255) none repeat scroll 0% 0%;color:rgb(51, 51, 51);font-size:14px;font-family:&quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Source Han Sans SC&quot;, DLSFallbackFont, sans-serif;line-height:1.42857;overflow:hidden;transform:initial;"><div style="box-sizing:border-box;"><div style="box-sizing:border-box;min-width:600px;justify-content:space-between;"><div style="box-sizing:border-box;min-width:896px;overflow:hidden;"><div style="box-sizing:border-box;"><div style="box-sizing:border-box;"><div style="box-sizing:border-box;"><div style="box-sizing:border-box;overflow:hidden;min-width:320px;"><div style="box-sizing:border-box;inset:0px;pointer-events:none;"><div style="box-sizing:border-box;background:rgb(255, 255, 255) none repeat scroll 0% 0%;pointer-events:all;"><div style="box-sizing:border-box;"><div style="box-sizing:border-box;"><div style="box-sizing:border-box;"><div style="box-sizing:border-box;display:flex;flex-direction:column;margin-top:15px;padding-bottom:14px;border-bottom:1px solid rgb(240, 240, 240);"><div style="box-sizing:border-box;display:flex;align-items:center;"><span style="box-sizing:border-box;padding:2px;text-decoration:none;display:inline-block;position:relative;"><img src="回溯搜索 + 剪枝 - 全排列 II - 力扣（LeetCode）_files/avatar_1565020052.png" type="image/png" data-filename="avatar_1565020052.png" height="19" style="box-sizing:border-box;vertical-align:middle;border-style:none;border-radius:50%;height:19px;width:19px;object-fit:cover;display:block;" width="19"/></span><h1 style="box-sizing:border-box;color:rgba(0, 0, 0, 0.85);font-weight:500;padding:0px;margin:0px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;font-size:16px;margin-left:8px;">回溯搜索 + 剪枝</h1></div><div style="box-sizing:border-box;display:flex;align-items:center;margin-top:4px;line-height:20px;white-space:nowrap;flex-wrap:wrap;"><a href="https://leetcode-cn.com/u/liweiwei1419/" style="box-sizing:border-box;background-color:transparent;outline:currentcolor none medium;cursor:pointer;transition:color 0.3s ease 0s;touch-action:manipulation;text-decoration:none;margin-top:8px;font-size:12px;color:rgb(140, 140, 140);">liweiwei1419</a><span style="box-sizing:border-box;margin-top:8px;color:rgb(140, 140, 140);font-size:12px;margin-left:8px;">发布于 10 个月前</span><span style="box-sizing:border-box;margin-top:8px;margin-right:18px;margin-left:18px;display:flex;align-items:center;font-size:12px;color:rgb(89, 89, 89);"><img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='1em' height='1em' fill='currentColor' class='css-3o0h5k js-evernote-checked' data-evernote-id='1301'%3e%3cpath fill-rule='evenodd' d='M1.104 12.444a1 1 0 010-.888c.13-.26.37-.693.722-1.241A18.848 18.848 0 013.88 7.652C6.184 5.176 8.896 3.667 12 3.667s5.816 1.509 8.119 3.985c.79.85 1.475 1.756 2.055 2.663.352.548.593.98.722 1.24a1 1 0 010 .89c-.13.26-.37.692-.722 1.24a18.848 18.848 0 01-2.055 2.663c-2.303 2.476-5.015 3.985-8.119 3.985s-5.816-1.509-8.119-3.985a18.848 18.848 0 01-2.055-2.663c-.352-.548-.593-.98-.722-1.24zm2.406.162a16.87 16.87 0 001.836 2.38c1.959 2.106 4.19 3.347 6.654 3.347 2.465 0 4.695-1.24 6.654-3.347A16.87 16.87 0 0020.86 12a16.87 16.87 0 00-2.206-2.986C16.695 6.908 14.464 5.667 12 5.667c-2.465 0-4.695 1.24-6.654 3.347A16.87 16.87 0 003.14 12c.108.188.232.39.37.606zM12 15.75c-2.06 0-3.727-1.68-3.727-3.75 0-2.07 1.667-3.75 3.727-3.75 2.06 0 3.727 1.68 3.727 3.75 0 2.07-1.667 3.75-3.727 3.75zm0-2c.952 0 1.727-.782 1.727-1.75s-.775-1.75-1.727-1.75c-.952 0-1.727.782-1.727 1.75s.775 1.75 1.727 1.75z' data-evernote-id='1302' class='js-evernote-checked'%3e%3c/path%3e%3c/svg%3e" style="box-sizing:border-box;width:16px;height:16px;margin-right:2px;color:rgb(140, 140, 140);overflow:hidden;"></img>37.7k</span><span style="box-sizing:border-box;margin-top:8px;user-select:none;font-size:12px;line-height:20px;display:inline-flex;align-items:center;justify-content:center;text-decoration:none;transition-property:color, background-color;transition-duration:0.3s;color:rgb(38, 38, 38);background-color:rgb(240, 240, 240);padding:0px 6px;min-width:40px;border-radius:999px;font-weight:normal;white-space:nowrap;margin-right:8px;"><span style="box-sizing:border-box;">回溯算法</span></span><span style="box-sizing:border-box;margin-top:8px;user-select:none;font-size:12px;line-height:20px;display:inline-flex;align-items:center;justify-content:center;text-decoration:none;transition-property:color, background-color;transition-duration:0.3s;color:rgb(38, 38, 38);background-color:rgb(240, 240, 240);padding:0px 6px;min-width:40px;border-radius:999px;font-weight:normal;white-space:nowrap;margin-right:8px;"><span style="box-sizing:border-box;">Java</span></span><span style="box-sizing:border-box;margin-top:8px;user-select:none;font-size:12px;line-height:20px;display:inline-flex;align-items:center;justify-content:center;text-decoration:none;transition-property:color, background-color;transition-duration:0.3s;color:rgb(38, 38, 38);background-color:rgb(240, 240, 240);padding:0px 6px;min-width:40px;border-radius:999px;font-weight:normal;white-space:nowrap;"><span style="box-sizing:border-box;">Python3</span></span></div></div><div style="box-sizing:border-box;position:relative;z-index:0;"><div style="box-sizing:border-box;font-family:Helvetica, arial, sans-serif;font-size:14px;line-height:1.6;background-color:white;word-break:break-word;position:relative;z-index:-1;padding:10px 0px;"><p align="center" style="box-sizing:border-box;margin:15px 0px;margin-top:0px;"><div style="box-sizing:border-box;box-shadow:rgba(0, 0, 0, 0.15) 0px 1px 3px;position:relative;max-width:1920px;"><div style="box-sizing:border-box;padding:28.125% 50%;"></div><div style="box-sizing:border-box;top:0px;left:0px;position:absolute;width:100%;height:300px;background-color:rgb(245, 245, 245);"><div style="box-sizing:border-box;background:rgba(0, 0, 0, 0) url(https://g.alicdn.com/de/prismplayer/2.8.7/skins/default/./img/bigplay.png) no-repeat scroll 0% 0% / contain;width:64px;height:64px;display:block;z-index:1000;position:absolute;left:30px;bottom:80px;"><div style="border:7px solid rgba(255, 255, 255, 0.51);width:64px;height:64px;border-radius:100%;position:absolute;top:0px;left:0px;box-sizing:border-box;"></div></div><div style="box-sizing:border-box; width:0px; height:0px; border-radius:; opacity:0; position:absolute; left:380px; top:213.75px; transform:matrix(1, 0, 0, 1, 0, 0); background:; animation:; float:none; margin-left:0px; margin-top:0px;"></div></div></div><span style="display:block;clear:both;"></span></p>
<p style="box-sizing:border-box;margin:15px 0px;">这一题是在「力扣」第 46 题： <a href="https://leetcode-cn.com/problems/permutations/" style="box-sizing:border-box;background-color:transparent;outline:currentcolor none medium;cursor:pointer;transition:color 0.3s ease 0s;touch-action:manipulation;color:rgb(84, 110, 122);text-decoration:underline;" target="_blank">“全排列”</a> 的基础上增加了“序列中的元素可重复”这一条件，但要求返回的结果又不能有重复元素。<span style="display:block;clear:both;"></span></p>
<p style="box-sizing:border-box;margin:15px 0px;">思路：<strong style="box-sizing:border-box;font-weight:bolder;">在一定会产生重复结果集的地方剪枝</strong>。<span style="display:block;clear:both;"></span></p>
<p style="box-sizing:border-box;margin:15px 0px;">一个比较容易想到的办法是在结果集中去重。但是问题又来了，这些结果集的元素是一个又一个列表，对列表去重不像用哈希表对基本元素去重那样容易。<span style="display:block;clear:both;"></span></p>
<p style="box-sizing:border-box;margin:15px 0px;">如果要比较两个列表是否一样，一个很显然的办法是分别排序，然后逐个比对。既然要排序，我们可以<strong style="box-sizing:border-box;font-weight:bolder;">在搜索之前就对候选数组排序</strong>，一旦发现这一支搜索下去可能搜索到重复的元素就停止搜索，这样结果集中不会包含重复元素。<span style="display:block;clear:both;"></span></p>
<p align="center" style="box-sizing:border-box;margin:15px 0px;"><img src="回溯搜索 + 剪枝 - 全排列 II - 力扣（LeetCode）_files/0f1c183ceb7b634f8a527028afd4893e26dfe3796afce35cbb177b125939179b-LeetCode 第 47 题：“全排列 II”题解配图.png" type="image/png" data-filename="0f1c183ceb7b634f8a527028afd4893e26dfe3796afce35cbb177b125939179b-LeetCode 第 47 题：“全排列 II”题解配图.png" height="428" style="box-sizing:border-box;vertical-align:middle;border-style:none;max-width:100%;" width="760"/><span style="display:block;clear:both;"></span></p>
<p style="box-sizing:border-box;margin:15px 0px;">产生重复结点的地方，正是图中标注了“剪刀”，且被绿色框框住的地方。<span style="display:block;clear:both;"></span></p>
<p style="box-sizing:border-box;margin:15px 0px;">大家也可以把第 2 个 <code style="box-sizing:border-box;font-size:1em;margin:0px 2px;padding:2px 4px;border:1px solid rgb(236, 239, 241);background:rgb(247, 249, 250) none repeat scroll 0% 0%;border-radius:3px;color:rgb(84, 110, 122);font-family:monospace;white-space:normal;box-decoration-break:clone;">1</code> 加上 <code style="box-sizing:border-box;font-size:1em;margin:0px 2px;padding:2px 4px;border:1px solid rgb(236, 239, 241);background:rgb(247, 249, 250) none repeat scroll 0% 0%;border-radius:3px;color:rgb(84, 110, 122);font-family:monospace;white-space:normal;box-decoration-break:clone;">'</code> ，即 <code style="box-sizing:border-box;font-size:1em;margin:0px 2px;padding:2px 4px;border:1px solid rgb(236, 239, 241);background:rgb(247, 249, 250) none repeat scroll 0% 0%;border-radius:3px;color:rgb(84, 110, 122);font-family:monospace;white-space:normal;box-decoration-break:clone;">[1, 1', 2]</code> 去想象这个搜索的过程。只要遇到起点一样，就有可能产生重复。这里还有一个很细节的地方：<span style="display:block;clear:both;"></span></p>
<p style="box-sizing:border-box;margin:15px 0px;">1、在图中 ② 处，搜索的数也和上一次一样，但是上一次的 <code style="box-sizing:border-box;font-size:1em;margin:0px 2px;padding:2px 4px;border:1px solid rgb(236, 239, 241);background:rgb(247, 249, 250) none repeat scroll 0% 0%;border-radius:3px;color:rgb(84, 110, 122);font-family:monospace;white-space:normal;box-decoration-break:clone;">1</code> 还在使用中；<br style="box-sizing:border-box;"/>
2、<strong style="box-sizing:border-box;font-weight:bolder;">在图中 ① 处，搜索的数也和上一次一样，但是上一次的 <code style="box-sizing:border-box;font-size:1em;margin:0px 2px;padding:2px 4px;border:1px solid rgb(236, 239, 241);background:rgb(247, 249, 250) none repeat scroll 0% 0%;border-radius:3px;color:rgb(84, 110, 122);font-family:monospace;white-space:normal;box-decoration-break:clone;">1</code> 刚刚被撤销，正是因为刚被撤销，下面的搜索中还会使用到，因此会产生重复，剪掉的就应该是这样的分支</strong>。<span style="display:block;clear:both;"></span></p>
<p style="box-sizing:border-box;margin:15px 0px;">代码实现方面，在第 46 题的基础上，要加上这样一段代码：<span style="display:block;clear:both;"></span></p>
<div style="box-sizing:border-box;border:1px solid rgb(238, 238, 238);box-shadow:rgba(0, 0, 0, 0.04) 0px 1px 5px 0px;border-radius:3px;margin-top:0px;"><ul style="box-sizing:border-box;padding:0px;margin:0px;user-select:none;border-bottom:1px solid rgb(238, 238, 238);white-space:nowrap;width:100%;overflow:auto;"><li style="box-sizing:border-box;display:inline-block;position:relative;margin:0px;margin-top:0px;"><span style="box-sizing:border-box;touch-action:manipulation;display:inline-block;padding:5px;margin:5px;font-size:12px;line-height:1;cursor:pointer;margin-top:0px;">Java</span></li></ul><pre style="box-sizing:border-box;font-family:SFMono-Regular, Consolas, Liberation Mono, Menlo, Courier, monospace;position:relative;background-color:rgb(247, 249, 250);line-height:19px;padding:12px;border-radius:3px;max-height:600px;font-size:13px;overflow:auto;margin:0px;"><code style="box-sizing:border-box;font-size:1em;border-radius:3px;color:rgb(84, 110, 122);font-family:monospace;box-decoration-break:clone;margin:0px;padding:0px;border:medium none;background:transparent none repeat scroll 0% 0%;white-space:pre;"><span style="box-sizing:border-box;color:rgb(170, 13, 145);">if</span> (i &gt; <span style="box-sizing:border-box;color:rgb(28, 0, 207);">0</span> &amp;&amp; nums[i] == nums[i - <span style="box-sizing:border-box;color:rgb(28, 0, 207);">1</span>] &amp;&amp; !used[i - <span style="box-sizing:border-box;color:rgb(28, 0, 207);">1</span>]) {
    <span style="box-sizing:border-box;color:rgb(170, 13, 145);">continue</span>;
}
</code></pre>
</div><p style="box-sizing:border-box;margin:15px 0px;">这段代码就能检测到标注为 ① 的两个结点，跳过它们。注意：这里 <code style="box-sizing:border-box;font-size:1em;margin:0px 2px;padding:2px 4px;border:1px solid rgb(236, 239, 241);background:rgb(247, 249, 250) none repeat scroll 0% 0%;border-radius:3px;color:rgb(84, 110, 122);font-family:monospace;white-space:normal;box-decoration-break:clone;">used[i - 1]</code> 不加 <code style="box-sizing:border-box;font-size:1em;margin:0px 2px;padding:2px 4px;border:1px solid rgb(236, 239, 241);background:rgb(247, 249, 250) none repeat scroll 0% 0%;border-radius:3px;color:rgb(84, 110, 122);font-family:monospace;white-space:normal;box-decoration-break:clone;">!</code>，测评也能通过。有兴趣的朋友可以想一想这是为什么。建议大家做这样几个对比实验：<span style="display:block;clear:both;"></span></p>
<p style="box-sizing:border-box;margin:15px 0px;">1、干脆就不写 <code style="box-sizing:border-box;font-size:1em;margin:0px 2px;padding:2px 4px;border:1px solid rgb(236, 239, 241);background:rgb(247, 249, 250) none repeat scroll 0% 0%;border-radius:3px;color:rgb(84, 110, 122);font-family:monospace;white-space:normal;box-decoration-break:clone;">!used[i - 1]</code> 结果是什么样？<br style="box-sizing:border-box;"/>
2、写 <code style="box-sizing:border-box;font-size:1em;margin:0px 2px;padding:2px 4px;border:1px solid rgb(236, 239, 241);background:rgb(247, 249, 250) none repeat scroll 0% 0%;border-radius:3px;color:rgb(84, 110, 122);font-family:monospace;white-space:normal;box-decoration-break:clone;">used[i - 1]</code> 结果是什么，代码又是怎样执行的。这里给的结论是：<code style="box-sizing:border-box;font-size:1em;margin:0px 2px;padding:2px 4px;border:1px solid rgb(236, 239, 241);background:rgb(247, 249, 250) none repeat scroll 0% 0%;border-radius:3px;color:rgb(84, 110, 122);font-family:monospace;white-space:normal;box-decoration-break:clone;">!used[i - 1]</code> 这样的剪枝更彻底。附录会分析原因。<span style="display:block;clear:both;"></span></p>
<p style="box-sizing:border-box;margin:15px 0px;"><strong style="box-sizing:border-box;font-weight:bolder;">参考代码 1</strong>：<span style="display:block;clear:both;"></span></p>
<div style="box-sizing:border-box;border:1px solid rgb(238, 238, 238);box-shadow:rgba(0, 0, 0, 0.04) 0px 1px 5px 0px;border-radius:3px;"><ul style="box-sizing:border-box;padding:0px;margin:0px;user-select:none;border-bottom:1px solid rgb(238, 238, 238);white-space:nowrap;width:100%;overflow:auto;"><li style="box-sizing:border-box;display:inline-block;position:relative;margin:0px;margin-top:0px;"><span style="box-sizing:border-box;touch-action:manipulation;display:inline-block;padding:5px;margin:5px;font-size:12px;line-height:1;cursor:pointer;margin-top:0px;">Java</span></li><li style="box-sizing:border-box;display:inline-block;position:relative;margin:0px;"><span style="height:12px;width:1px;background:rgb(238, 238, 238) none repeat scroll 0% 0%;position:absolute;left:0px;top:50%;transform:translate(-50%, -50%);"></span><span style="box-sizing:border-box;touch-action:manipulation;display:inline-block;padding:5px;margin:5px;font-size:12px;line-height:1;cursor:pointer;margin-top:0px;opacity:0.5;">Python</span></li></ul><pre style="box-sizing:border-box;font-family:SFMono-Regular, Consolas, Liberation Mono, Menlo, Courier, monospace;position:relative;background-color:rgb(247, 249, 250);line-height:19px;padding:12px;border-radius:3px;max-height:600px;font-size:13px;overflow:auto;margin:0px;"><code style="box-sizing:border-box;font-size:1em;border-radius:3px;color:rgb(84, 110, 122);font-family:monospace;box-decoration-break:clone;margin:0px;padding:0px;border:medium none;background:transparent none repeat scroll 0% 0%;white-space:pre;"><span style="box-sizing:border-box;color:rgb(170, 13, 145);">import</span> java.util.ArrayDeque;
<span style="box-sizing:border-box;color:rgb(170, 13, 145);">import</span> java.util.ArrayList;
<span style="box-sizing:border-box;color:rgb(170, 13, 145);">import</span> java.util.Arrays;
<span style="box-sizing:border-box;color:rgb(170, 13, 145);">import</span> java.util.Deque;
<span style="box-sizing:border-box;color:rgb(170, 13, 145);">import</span> java.util.List;

<span style="box-sizing:border-box;color:rgb(170, 13, 145);">public</span> <span style="box-sizing:border-box;"><span style="box-sizing:border-box;color:rgb(170, 13, 145);">class</span> <span style="box-sizing:border-box;color:rgb(92, 38, 153);">Solution</span> </span>{

    <span style="box-sizing:border-box;color:rgb(170, 13, 145);">public</span> List&lt;List&lt;Integer&gt;&gt; permuteUnique(<span style="box-sizing:border-box;color:rgb(170, 13, 145);">int</span>[] nums) {
        <span style="box-sizing:border-box;color:rgb(170, 13, 145);">int</span> len = nums.length;
        List&lt;List&lt;Integer&gt;&gt; res = <span style="box-sizing:border-box;color:rgb(170, 13, 145);">new</span> ArrayList&lt;&gt;();
        <span style="box-sizing:border-box;color:rgb(170, 13, 145);">if</span> (len == <span style="box-sizing:border-box;color:rgb(28, 0, 207);">0</span>) {
            <span style="box-sizing:border-box;color:rgb(170, 13, 145);">return</span> res;
        }

        <span style="box-sizing:border-box;color:rgb(0, 106, 0);">// 排序（升序或者降序都可以），排序是剪枝的前提</span>
        Arrays.sort(nums);

        <span style="box-sizing:border-box;color:rgb(170, 13, 145);">boolean</span>[] used = <span style="box-sizing:border-box;color:rgb(170, 13, 145);">new</span> <span style="box-sizing:border-box;color:rgb(170, 13, 145);">boolean</span>[len];
        <span style="box-sizing:border-box;color:rgb(0, 106, 0);">// 使用 Deque 是 Java 官方 Stack 类的建议</span>
        Deque&lt;Integer&gt; path = <span style="box-sizing:border-box;color:rgb(170, 13, 145);">new</span> ArrayDeque&lt;&gt;(len);
        dfs(nums, len, <span style="box-sizing:border-box;color:rgb(28, 0, 207);">0</span>, used, path, res);
        <span style="box-sizing:border-box;color:rgb(170, 13, 145);">return</span> res;
    }

    <span style="box-sizing:border-box;"><span style="box-sizing:border-box;color:rgb(170, 13, 145);">private</span> <span style="box-sizing:border-box;color:rgb(170, 13, 145);">void</span> <span style="box-sizing:border-box;color:rgb(28, 0, 207);">dfs</span><span style="box-sizing:border-box;color:rgb(92, 38, 153);">(<span style="box-sizing:border-box;color:rgb(170, 13, 145);">int</span>[] nums, <span style="box-sizing:border-box;color:rgb(170, 13, 145);">int</span> len, <span style="box-sizing:border-box;color:rgb(170, 13, 145);">int</span> depth, <span style="box-sizing:border-box;color:rgb(170, 13, 145);">boolean</span>[] used, Deque&lt;Integer&gt; path, List&lt;List&lt;Integer&gt;&gt; res)</span> </span>{
        <span style="box-sizing:border-box;color:rgb(170, 13, 145);">if</span> (depth == len) {
            res.add(<span style="box-sizing:border-box;color:rgb(170, 13, 145);">new</span> ArrayList&lt;&gt;(path));
            <span style="box-sizing:border-box;color:rgb(170, 13, 145);">return</span>;
        }

        <span style="box-sizing:border-box;color:rgb(170, 13, 145);">for</span> (<span style="box-sizing:border-box;color:rgb(170, 13, 145);">int</span> i = <span style="box-sizing:border-box;color:rgb(28, 0, 207);">0</span>; i &lt; len; ++i) {
            <span style="box-sizing:border-box;color:rgb(170, 13, 145);">if</span> (used[i]) {
                <span style="box-sizing:border-box;color:rgb(170, 13, 145);">continue</span>;
            }

            <span style="box-sizing:border-box;color:rgb(0, 106, 0);">// 剪枝条件：i &gt; 0 是为了保证 nums[i - 1] 有意义</span>
            <span style="box-sizing:border-box;color:rgb(0, 106, 0);">// 写 !used[i - 1] 是因为 nums[i - 1] 在深度优先遍历的过程中刚刚被撤销选择</span>
            <span style="box-sizing:border-box;color:rgb(170, 13, 145);">if</span> (i &gt; <span style="box-sizing:border-box;color:rgb(28, 0, 207);">0</span> &amp;&amp; nums[i] == nums[i - <span style="box-sizing:border-box;color:rgb(28, 0, 207);">1</span>] &amp;&amp; !used[i - <span style="box-sizing:border-box;color:rgb(28, 0, 207);">1</span>]) {
                <span style="box-sizing:border-box;color:rgb(170, 13, 145);">continue</span>;
            }

            path.addLast(nums[i]);
            used[i] = <span style="box-sizing:border-box;color:rgb(170, 13, 145);">true</span>;

            dfs(nums, len, depth + <span style="box-sizing:border-box;color:rgb(28, 0, 207);">1</span>, used, path, res);
            <span style="box-sizing:border-box;color:rgb(0, 106, 0);">// 回溯部分的代码，和 dfs 之前的代码是对称的</span>
            used[i] = <span style="box-sizing:border-box;color:rgb(170, 13, 145);">false</span>;
            path.removeLast();
        }
    }

    <span style="box-sizing:border-box;"><span style="box-sizing:border-box;color:rgb(170, 13, 145);">public</span> <span style="box-sizing:border-box;color:rgb(170, 13, 145);">static</span> <span style="box-sizing:border-box;color:rgb(170, 13, 145);">void</span> <span style="box-sizing:border-box;color:rgb(28, 0, 207);">main</span><span style="box-sizing:border-box;color:rgb(92, 38, 153);">(String[] args)</span> </span>{
        Solution solution = <span style="box-sizing:border-box;color:rgb(170, 13, 145);">new</span> Solution();
        <span style="box-sizing:border-box;color:rgb(170, 13, 145);">int</span>[] nums = {<span style="box-sizing:border-box;color:rgb(28, 0, 207);">1</span>, <span style="box-sizing:border-box;color:rgb(28, 0, 207);">1</span>, <span style="box-sizing:border-box;color:rgb(28, 0, 207);">2</span>};
        List&lt;List&lt;Integer&gt;&gt; res = solution.permuteUnique(nums);
        System.out.println(res);
    }
}
</code></pre>

</div><p style="box-sizing:border-box;margin:15px 0px;"><strong style="box-sizing:border-box;font-weight:bolder;">复杂度分析</strong>：（理由同第 46 题，重复元素越多，剪枝越多。但是计算复杂度的时候需要考虑最差情况。）<span style="display:block;clear:both;"></span></p>
<ul style="box-sizing:border-box;margin:15px 0px;padding-left:30px;margin-top:0px;margin-bottom:0px;">
<li style="box-sizing:border-box;margin:0px;margin-top:0px;">时间复杂度：<span style="box-sizing:border-box;font:1.21em / 1.2 KaTeX_Main, Times New Roman, serif;text-indent:0px;text-rendering:auto;position:relative;margin-top:0px;"><span style="box-sizing:border-box;position:absolute;clip:rect(1px, 1px, 1px, 1px);padding:0px;border:0px none;height:1px;width:1px;overflow:hidden;margin-top:0px;"><span style="box-sizing:border-box;margin-top:0px;"><span style="box-sizing:border-box;margin-top:0px;"><span style="box-sizing:border-box;margin-top:0px;"><span style="box-sizing:border-box;margin-top:0px;">O</span><span style="box-sizing:border-box;margin-top:0px;">(</span><span style="box-sizing:border-box;">N</span><span style="box-sizing:border-box;">×</span><span style="box-sizing:border-box;">N</span><span style="box-sizing:border-box;">!</span><span style="box-sizing:border-box;">)</span></span><span style="box-sizing:border-box;margin-top:0px;">O(N \times N!)</span></span></span></span><span style="box-sizing:border-box;"><span style="box-sizing:border-box;position:relative;white-space:nowrap;width:min-content;display:inline-block;margin-top:0px;"><span style="box-sizing:border-box;display:inline-block;margin-top:0px;height:1em;vertical-align:-0.25em;"></span><span style="box-sizing:border-box;font-family:KaTeX_Math;font-style:italic;margin-right:0.02778em;">O</span><span style="box-sizing:border-box;">(</span><span style="box-sizing:border-box;font-family:KaTeX_Math;font-style:italic;margin-right:0.10903em;">N</span><span style="box-sizing:border-box;display:inline-block;margin-right:0.2222222222222222em;"></span><span style="box-sizing:border-box;">×</span><span style="box-sizing:border-box;display:inline-block;margin-right:0.2222222222222222em;"></span></span><span style="box-sizing:border-box;position:relative;white-space:nowrap;width:min-content;display:inline-block;"><span style="box-sizing:border-box;display:inline-block;margin-top:0px;height:1em;vertical-align:-0.25em;"></span><span style="box-sizing:border-box;font-family:KaTeX_Math;font-style:italic;margin-right:0.10903em;">N</span><span style="box-sizing:border-box;">!</span><span style="box-sizing:border-box;">)</span></span></span></span>，这里 <span style="box-sizing:border-box;font:1.21em / 1.2 KaTeX_Main, Times New Roman, serif;text-indent:0px;text-rendering:auto;position:relative;"><span style="box-sizing:border-box;position:absolute;clip:rect(1px, 1px, 1px, 1px);padding:0px;border:0px none;height:1px;width:1px;overflow:hidden;margin-top:0px;"><span style="box-sizing:border-box;margin-top:0px;"><span style="box-sizing:border-box;margin-top:0px;"><span style="box-sizing:border-box;margin-top:0px;"><span style="box-sizing:border-box;margin-top:0px;">N</span></span><span style="box-sizing:border-box;margin-top:0px;">N</span></span></span></span><span style="box-sizing:border-box;"><span style="box-sizing:border-box;position:relative;white-space:nowrap;width:min-content;display:inline-block;margin-top:0px;"><span style="box-sizing:border-box;display:inline-block;margin-top:0px;height:0.68333em;vertical-align:0em;"></span><span style="box-sizing:border-box;font-family:KaTeX_Math;font-style:italic;margin-right:0.10903em;">N</span></span></span></span> 为数组的长度。</li>
<li style="box-sizing:border-box;margin:0px;">空间复杂度：<span style="box-sizing:border-box;font:1.21em / 1.2 KaTeX_Main, Times New Roman, serif;text-indent:0px;text-rendering:auto;position:relative;margin-top:0px;"><span style="box-sizing:border-box;position:absolute;clip:rect(1px, 1px, 1px, 1px);padding:0px;border:0px none;height:1px;width:1px;overflow:hidden;margin-top:0px;"><span style="box-sizing:border-box;margin-top:0px;"><span style="box-sizing:border-box;margin-top:0px;"><span style="box-sizing:border-box;margin-top:0px;"><span style="box-sizing:border-box;margin-top:0px;">O</span><span style="box-sizing:border-box;margin-top:0px;">(</span><span style="box-sizing:border-box;">N</span><span style="box-sizing:border-box;">×</span><span style="box-sizing:border-box;">N</span><span style="box-sizing:border-box;">!</span><span style="box-sizing:border-box;">)</span></span><span style="box-sizing:border-box;margin-top:0px;">O(N \times N!)</span></span></span></span><span style="box-sizing:border-box;"><span style="box-sizing:border-box;position:relative;white-space:nowrap;width:min-content;display:inline-block;margin-top:0px;"><span style="box-sizing:border-box;display:inline-block;margin-top:0px;height:1em;vertical-align:-0.25em;"></span><span style="box-sizing:border-box;font-family:KaTeX_Math;font-style:italic;margin-right:0.02778em;">O</span><span style="box-sizing:border-box;">(</span><span style="box-sizing:border-box;font-family:KaTeX_Math;font-style:italic;margin-right:0.10903em;">N</span><span style="box-sizing:border-box;display:inline-block;margin-right:0.2222222222222222em;"></span><span style="box-sizing:border-box;">×</span><span style="box-sizing:border-box;display:inline-block;margin-right:0.2222222222222222em;"></span></span><span style="box-sizing:border-box;position:relative;white-space:nowrap;width:min-content;display:inline-block;"><span style="box-sizing:border-box;display:inline-block;margin-top:0px;height:1em;vertical-align:-0.25em;"></span><span style="box-sizing:border-box;font-family:KaTeX_Math;font-style:italic;margin-right:0.10903em;">N</span><span style="box-sizing:border-box;">!</span><span style="box-sizing:border-box;">)</span></span></span></span>。<br style="box-sizing:border-box;margin-top:0px;"/>
<br style="box-sizing:border-box;"/></li>
</ul>
<hr style="overflow:visible;box-sizing:content-box;border:0px none;background-color:rgb(238, 238, 238);padding:0px;margin:50px 0px;height:1px;margin-top:0px;margin-bottom:0px;"/>
<p style="box-sizing:border-box;margin:15px 0px;"><br style="box-sizing:border-box;"/><span style="display:block;clear:both;"></span></p>
<h2 style="box-sizing:border-box;cursor:text;position:relative;font-weight:bold;padding:0px;margin:20px 0px 10px;font-size:24px;color:black;padding-top:0px;margin-top:0px;margin-bottom:0px;">补充说明（这部分内容不太重要，只要理解上面深搜是怎么剪枝的就行）</h2>
<p style="box-sizing:border-box;margin:15px 0px;"><strong style="box-sizing:border-box;font-weight:bolder;">写 <code style="box-sizing:border-box;font-size:1em;margin:0px 2px;padding:2px 4px;border:1px solid rgb(236, 239, 241);background:rgb(247, 249, 250) none repeat scroll 0% 0%;border-radius:3px;color:rgb(84, 110, 122);font-family:monospace;white-space:normal;box-decoration-break:clone;">used[i - 1]</code> 代码正确，但是不推荐的原因。</strong><span style="display:block;clear:both;"></span></p>
<p style="box-sizing:border-box;margin:15px 0px;">思路是根据深度优先遍历的执行流程，看一看那些状态变量（布尔数组 <code style="box-sizing:border-box;font-size:1em;margin:0px 2px;padding:2px 4px;border:1px solid rgb(236, 239, 241);background:rgb(247, 249, 250) none repeat scroll 0% 0%;border-radius:3px;color:rgb(84, 110, 122);font-family:monospace;white-space:normal;box-decoration-break:clone;">used</code>）的值。<span style="display:block;clear:both;"></span></p>
<p style="box-sizing:border-box;margin:15px 0px;">1、如果剪枝写的是：<span style="display:block;clear:both;"></span></p>
<div style="box-sizing:border-box;border:1px solid rgb(238, 238, 238);box-shadow:rgba(0, 0, 0, 0.04) 0px 1px 5px 0px;border-radius:3px;"><ul style="box-sizing:border-box;padding:0px;margin:0px;user-select:none;border-bottom:1px solid rgb(238, 238, 238);white-space:nowrap;width:100%;overflow:auto;"><li style="box-sizing:border-box;display:inline-block;position:relative;margin:0px;margin-top:0px;"><span style="box-sizing:border-box;touch-action:manipulation;display:inline-block;padding:5px;margin:5px;font-size:12px;line-height:1;cursor:pointer;margin-top:0px;">Java</span></li></ul><pre style="box-sizing:border-box;font-family:SFMono-Regular, Consolas, Liberation Mono, Menlo, Courier, monospace;position:relative;background-color:rgb(247, 249, 250);line-height:19px;padding:12px;border-radius:3px;max-height:600px;font-size:13px;overflow:auto;margin:0px;"><code style="box-sizing:border-box;font-size:1em;border-radius:3px;color:rgb(84, 110, 122);font-family:monospace;box-decoration-break:clone;margin:0px;padding:0px;border:medium none;background:transparent none repeat scroll 0% 0%;white-space:pre;"><span style="box-sizing:border-box;color:rgb(170, 13, 145);">if</span> (i &gt; <span style="box-sizing:border-box;color:rgb(28, 0, 207);">0</span> &amp;&amp; nums[i] == nums[i - <span style="box-sizing:border-box;color:rgb(28, 0, 207);">1</span>] &amp;&amp; !used[i - <span style="box-sizing:border-box;color:rgb(28, 0, 207);">1</span>]) {
    <span style="box-sizing:border-box;color:rgb(170, 13, 145);">continue</span>;
}
</code></pre>
</div><p style="box-sizing:border-box;margin:15px 0px;">那么，对于数组 <code style="box-sizing:border-box;font-size:1em;margin:0px 2px;padding:2px 4px;border:1px solid rgb(236, 239, 241);background:rgb(247, 249, 250) none repeat scroll 0% 0%;border-radius:3px;color:rgb(84, 110, 122);font-family:monospace;white-space:normal;box-decoration-break:clone;">[1, 1’, 1’’, 2]</code>，回溯的过程如下：<span style="display:block;clear:both;"></span></p>
<p align="center" style="box-sizing:border-box;margin:15px 0px;"><img src="回溯搜索 + 剪枝 - 全排列 II - 力扣（LeetCode）_files/9b0bf81d73d18e890491e1c6d6c3b40d85ebe37ca38934759e86e84d1d421e22-image.png" type="image/png" data-filename="9b0bf81d73d18e890491e1c6d6c3b40d85ebe37ca38934759e86e84d1d421e22-image.png" height="400" style="box-sizing:border-box;vertical-align:middle;border-style:none;max-width:100%;" width="760"/><span style="display:block;clear:both;"></span></p>
<p style="box-sizing:border-box;margin:15px 0px;">得到的全排列是：<code style="box-sizing:border-box;font-size:1em;margin:0px 2px;padding:2px 4px;border:1px solid rgb(236, 239, 241);background:rgb(247, 249, 250) none repeat scroll 0% 0%;border-radius:3px;color:rgb(84, 110, 122);font-family:monospace;white-space:normal;box-decoration-break:clone;">[[1, 1', 1'', 2], [1, 1', 2, 1''], [1, 2, 1', 1''], [2, 1, 1', 1'']]</code>。特点是：<code style="box-sizing:border-box;font-size:1em;margin:0px 2px;padding:2px 4px;border:1px solid rgb(236, 239, 241);background:rgb(247, 249, 250) none repeat scroll 0% 0%;border-radius:3px;color:rgb(84, 110, 122);font-family:monospace;white-space:normal;box-decoration-break:clone;">1</code>、<code style="box-sizing:border-box;font-size:1em;margin:0px 2px;padding:2px 4px;border:1px solid rgb(236, 239, 241);background:rgb(247, 249, 250) none repeat scroll 0% 0%;border-radius:3px;color:rgb(84, 110, 122);font-family:monospace;white-space:normal;box-decoration-break:clone;">1'</code>、<code style="box-sizing:border-box;font-size:1em;margin:0px 2px;padding:2px 4px;border:1px solid rgb(236, 239, 241);background:rgb(247, 249, 250) none repeat scroll 0% 0%;border-radius:3px;color:rgb(84, 110, 122);font-family:monospace;white-space:normal;box-decoration-break:clone;">1''</code> 出现的顺序只能是 <code style="box-sizing:border-box;font-size:1em;margin:0px 2px;padding:2px 4px;border:1px solid rgb(236, 239, 241);background:rgb(247, 249, 250) none repeat scroll 0% 0%;border-radius:3px;color:rgb(84, 110, 122);font-family:monospace;white-space:normal;box-decoration-break:clone;">1</code>、<code style="box-sizing:border-box;font-size:1em;margin:0px 2px;padding:2px 4px;border:1px solid rgb(236, 239, 241);background:rgb(247, 249, 250) none repeat scroll 0% 0%;border-radius:3px;color:rgb(84, 110, 122);font-family:monospace;white-space:normal;box-decoration-break:clone;">1'</code>、<code style="box-sizing:border-box;font-size:1em;margin:0px 2px;padding:2px 4px;border:1px solid rgb(236, 239, 241);background:rgb(247, 249, 250) none repeat scroll 0% 0%;border-radius:3px;color:rgb(84, 110, 122);font-family:monospace;white-space:normal;box-decoration-break:clone;">1''</code>。<span style="display:block;clear:both;"></span></p>
<p style="box-sizing:border-box;margin:15px 0px;">2、如果剪枝写的是：<span style="display:block;clear:both;"></span></p>
<div style="box-sizing:border-box;border:1px solid rgb(238, 238, 238);box-shadow:rgba(0, 0, 0, 0.04) 0px 1px 5px 0px;border-radius:3px;margin-bottom:0px;"><ul style="box-sizing:border-box;padding:0px;margin:0px;user-select:none;border-bottom:1px solid rgb(238, 238, 238);white-space:nowrap;width:100%;overflow:auto;"><li style="box-sizing:border-box;display:inline-block;position:relative;margin:0px;margin-top:0px;"><span style="box-sizing:border-box;touch-action:manipulation;display:inline-block;padding:5px;margin:5px;font-size:12px;line-height:1;cursor:pointer;margin-top:0px;">Java</span></li></ul><pre style="box-sizing:border-box;font-family:SFMono-Regular, Consolas, Liberation Mono, Menlo, Courier, monospace;position:relative;background-color:rgb(247, 249, 250);line-height:19px;padding:12px;border-radius:3px;max-height:600px;font-size:13px;overflow:auto;margin:0px;"><code style="box-sizing:border-box;font-size:1em;border-radius:3px;color:rgb(84, 110, 122);font-family:monospace;box-decoration-break:clone;margin:0px;padding:0px;border:medium none;background:transparent none repeat scroll 0% 0%;white-space:pre;"><span style="box-sizing:border-box;color:rgb(170, 13, 145);">if</span> (i &gt; <span style="box-sizing:border-box;color:rgb(28, 0, 207);">0</span> &amp;&amp; nums[i] == nums[i - <span style="box-sizing:border-box;color:rgb(28, 0, 207);">1</span>] &amp;&amp; used[i - <span style="box-sizing:border-box;color:rgb(28, 0, 207);">1</span>]) {
    <span style="box-sizing:border-box;color:rgb(170, 13, 145);">continue</span>;
}
</code></pre>
</div><p style="box-sizing:border-box;margin:15px 0px;">那么，对于数组 <code style="box-sizing:border-box;font-size:1em;margin:0px 2px;padding:2px 4px;border:1px solid rgb(236, 239, 241);background:rgb(247, 249, 250) none repeat scroll 0% 0%;border-radius:3px;color:rgb(84, 110, 122);font-family:monospace;white-space:normal;box-decoration-break:clone;">[1, 1’, 1’’, 2]</code>，回溯的过程如下（因为过程稍显繁琐，所以没有画在一张图里）：<span style="display:block;clear:both;"></span></p>
<p style="box-sizing:border-box;margin:15px 0px;">（1）先选第 1 个数字，有 4 种取法。<span style="display:block;clear:both;"></span></p>
<p align="center" style="box-sizing:border-box;margin:15px 0px;"><img src="回溯搜索 + 剪枝 - 全排列 II - 力扣（LeetCode）_files/06bf98f9da46f538554aa17d5cc1063761557fb358e1e12dc10c55858cc2f5fe-image.png" type="image/png" data-filename="06bf98f9da46f538554aa17d5cc1063761557fb358e1e12dc10c55858cc2f5fe-image.png" height="196" style="box-sizing:border-box;vertical-align:middle;border-style:none;max-width:100%;" width="760"/><span style="display:block;clear:both;"></span></p>
<p style="box-sizing:border-box;margin:15px 0px;">（2）对第 1 步的第 1 个分支，可以继续搜索，但是发现，没有搜索到合适的叶子结点。<span style="display:block;clear:both;"></span></p>
<p align="center" style="box-sizing:border-box;margin:15px 0px;"><img src="回溯搜索 + 剪枝 - 全排列 II - 力扣（LeetCode）_files/41fff3d76a09688798f2cc37c638d799aca0d234fb6df1ac60ee99654934c745-image.png" type="image/png" data-filename="41fff3d76a09688798f2cc37c638d799aca0d234fb6df1ac60ee99654934c745-image.png" height="430" style="box-sizing:border-box;vertical-align:middle;border-style:none;max-width:100%;" width="760"/><span style="display:block;clear:both;"></span></p>
<p style="box-sizing:border-box;margin:15px 0px;">（3）对第 1 步的第 2 个分支，可以继续搜索，但是同样发现，没有搜索到合适的叶子结点。<span style="display:block;clear:both;"></span></p>
<p align="center" style="box-sizing:border-box;margin:15px 0px;"><img src="回溯搜索 + 剪枝 - 全排列 II - 力扣（LeetCode）_files/b9163201e31e038df7cafef3fbe56f6d7c393c28b57679da7dc0511a19fc5115-image.png" type="image/png" data-filename="b9163201e31e038df7cafef3fbe56f6d7c393c28b57679da7dc0511a19fc5115-image.png" height="367" style="box-sizing:border-box;vertical-align:middle;border-style:none;max-width:100%;" width="760"/><span style="display:block;clear:both;"></span></p>
<p style="box-sizing:border-box;margin:15px 0px;">（4）对第 1 步的第 3 个分支，继续搜索发现搜索到合适的叶子结点。<span style="display:block;clear:both;"></span></p>
<p align="center" style="box-sizing:border-box;margin:15px 0px;"><img src="回溯搜索 + 剪枝 - 全排列 II - 力扣（LeetCode）_files/70098e931f78388622eb6705c25ddfa3bd8a912c3934546d5f244c2d1825cc95-image.png" type="image/png" data-filename="70098e931f78388622eb6705c25ddfa3bd8a912c3934546d5f244c2d1825cc95-image.png" height="511" style="box-sizing:border-box;vertical-align:middle;border-style:none;max-width:100%;" width="760"/><span style="display:block;clear:both;"></span></p>
<p style="box-sizing:border-box;margin:15px 0px;">（5）对第 1 步的第 4 个分支，继续搜索发现搜索到合适的叶子结点。<span style="display:block;clear:both;"></span></p>
<p align="center" style="box-sizing:border-box;margin:15px 0px;"><img src="回溯搜索 + 剪枝 - 全排列 II - 力扣（LeetCode）_files/299ba9a47a9ae93c2331f6ce9f93c614a647397665f57bf072a11fe0a387b35f-image.png" type="image/png" data-filename="299ba9a47a9ae93c2331f6ce9f93c614a647397665f57bf072a11fe0a387b35f-image.png" height="361" style="box-sizing:border-box;vertical-align:middle;border-style:none;max-width:100%;" width="760"/><span style="display:block;clear:both;"></span></p>
<p style="box-sizing:border-box;margin:15px 0px;margin-bottom:0px;">因此，<code style="box-sizing:border-box;font-size:1em;margin:0px 2px;padding:2px 4px;border:1px solid rgb(236, 239, 241);background:rgb(247, 249, 250) none repeat scroll 0% 0%;border-radius:3px;color:rgb(84, 110, 122);font-family:monospace;white-space:normal;box-decoration-break:clone;">used[i - 1]</code> 前面加不加感叹号的区别仅在于保留的是相同元素的顺序索引，还是倒序索引。<strong style="box-sizing:border-box;font-weight:bolder;">很明显，顺序索引（即使用 <code style="box-sizing:border-box;font-size:1em;margin:0px 2px;padding:2px 4px;border:1px solid rgb(236, 239, 241);background:rgb(247, 249, 250) none repeat scroll 0% 0%;border-radius:3px;color:rgb(84, 110, 122);font-family:monospace;white-space:normal;box-decoration-break:clone;">!used[i - 1]</code> 作为剪枝判定条件得到）的递归树剪枝更彻底，思路也相对较自然</strong>。<span style="display:block;clear:both;"></span></p>
</div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
</span>
</div></body></html> 