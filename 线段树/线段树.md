# 线段树

线段树是用一种树状结构来存储一个连续区间的信息的数据结构。它主要用于处理连续区间的插入、查找、统计、查询等操作。

复杂度：设区间长度是n，所有操作的复杂度是logN级别。

``` java
			
						  [1,7]      (l+r)/2
		                 /       \
                       [1,4]      [5,7]
                       /   \       /   \
                    [1,2] [3,4]   [5,6] [7]
			       /  \   /  \    /   \
                   [1] [2] [3] [4] [5] [6]
```

## 线段树的几点性质

* 线段树是平衡的二叉树，最大深度logN（N为线段树所表示区间的长度）。
* 树中的每一个节点代表对应一个区间（叶子节点是一个点）。
* 每个节点（把代表的区间）完全包含它的所有子孙节点。
* 对于任意两个节点（所代表的区间）：要么完全包含，要么互不相交。



```tree```数组长度要开4倍已给数组的长度。

```java
// p 为节点编号，l 为左界，r 为右界
void build(int p,int l,int r){
    if(l==r) {
        tree[p]=a[l];
        return;
    }
    int mid = (l+r)/2;
    build(p*2,l,mid);
    build(p*2+1,mid+1,r);
    // 维护
    tree[p]=tree[p*2]+tree[p*2+1];
}
```



## 区间修改和区间查询

给定N个数，Q个操作，操作有两种：

* 'Q a b' 是查询a~b 这段数的和；
* 'C a b c' 是把a~b这段数都加上c；